---
title: vite搭建
author: Zodea
author_url: https://github.com/zodea
tags: ["vite", "vue3", "pinia", "ESLint", "TypeScript"]
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## pnpm
相较 [npm](https://www.npmjs.com/) 、 [yarn](https://yarnpkg.com/) 使用 [pnpm](https://www.pnpm.cn/) 的一个优势是，节省磁盘空间并提升安装速度，详情可点击官网查看。相对部分旧项目，pnpm可能在依赖结构上有所问题，所以尽可能在新项目中使用。

<Tabs
  groupId="pnpm"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'npx', value: 'npx'},
  ]}>
  <TabItem value="npm">

  ```shell
  npm install -g pnpm
  ```

  </TabItem>
  <TabItem value="npx">

  ```shell
  npx pnpm add -g pnpm
  ```

  </TabItem>
</Tabs>

为了减少内存的使用，pnpm在更新插件的时候会自动清理掉低版本的依赖，当然你也可以使用 `pnpm store prune` 对未引用的依赖进行删除。当你在切换分支时，如果依赖有不同，且被清理掉了，则需要安装缺少的依赖才可继续运行。

## vite
[Vite](https://cn.vitejs.dev/) 相较 [webpack](https://webpack.docschina.org/) 依旧是快，而且这个也是基于Vite2搭建，所以如果想使用webpack系列的，可以查看[Vue CLI](https://cli.vuejs.org/zh/) 的教程进行安装。

下面是搭建方法

<Tabs
  groupId="vite_boilerplate"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'yarn', value: 'yarn'},
    {label: 'pnpm', value: 'pnpm'},
  ]}>
  <TabItem value="npm">

  ```shell
  npm init vite@latest
  ```

  </TabItem>
  <TabItem value="yarn">

  ```shell
  yarn create vite
  ```

  </TabItem>
  <TabItem value="pnpm">

  ```shell
  pnpx create-vite
  ```

  </TabItem>
</Tabs>

<!--truncate-->


然后按照提示操作即可！

你还可以通过附加的命令行选项直接指定项目名称和你想要使用的模板。例如，要构建一个 Vite + Vue 项目，运行:

<Tabs
  groupId="vite_boilerplate"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'yarn', value: 'yarn'},
    {label: 'pnpm', value: 'pnpm'},
  ]}>
  <TabItem value="npm">

  ```shell
  # npm 6.x
  npm init vite@latest my-vue-app --template vue-ts

  # npm 7+, 需要额外的双横线：
  npm init vite@latest my-vue-app -- --template vue-ts
  ```

  </TabItem>
  <TabItem value="yarn">

  ```shell
  yarn create vite my-vue-app --template vue-ts
  ```

  </TabItem>
  <TabItem value="pnpm">

  ```shell
  pnpx create-vite my-vue-app --template vue-ts
  ```

  </TabItem>
</Tabs>


## ESLint
安装代码检测工具，并在vite中启用自动更新

<Tabs
  groupId="vite_boilerplate"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'yarn', value: 'yarn'},
    {label: 'pnpm', value: 'pnpm'},
  ]}>
  <TabItem value="npm">

  ```shell
  npm i -D eslint typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser
  npx eslint --init
  ```

  </TabItem>
  <TabItem value="yarn">

  ```shell
  yarn add -D eslint typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser
  yarn run eslint --init
  ```

  </TabItem>
  <TabItem value="pnpm">

  ```shell
  pnpm i -D eslint typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser
  pnpx eslint --init
  ```

  </TabItem>
</Tabs>

再安装eslint-define-config，通过其提示的eslint对象属性的功能，更便于样式的管理
<Tabs
  groupId="vite_boilerplate"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'yarn', value: 'yarn'},
    {label: 'pnpm', value: 'pnpm'},
  ]}>
  <TabItem value="npm">

  ```shell
  npm i -D eslint-define-config
  ```

  </TabItem>
  <TabItem value="yarn">

  ```shell
  yarn add -D eslint-define-config
  ```

  </TabItem>
  <TabItem value="pnpm">

  ```shell
  pnpm i -D eslint-define-config
  ```

  </TabItem>
</Tabs>

然后我们可以在根目录下新增以下配置
```javascript title=".eslintrc.js"
// @ts-check
const { defineConfig } = require("eslint-define-config");
module.exports = defineConfig({
  root: true,
  parser: '@typescript-eslint/parser',
  plugins: [
    '@typescript-eslint',
  ],
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
  ],
});
```
解释一下重要的部分
- `parser: '@typescript-eslint/parser'`告诉ESLint使用你安装的解析器包（[@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/fa35e22702207baf07acb3eec11d3383721bf6b6/packages/parser)）。
  - 这使得ESLint能够理解TypeScript的语法。
  - 这是必须的，否则ESLint会在试图解析TypeScript代码时抛出错误，就像它是普通的JavaScript一样。
- `plugins: ['@typescript-eslint']` 告诉ESLint加载你安装的插件包（[@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/fa35e22702207baf07acb3eec11d3383721bf6b6/packages/eslint-plugin)）。
  - 这允许你在你的代码库中使用这些规则。
- `extends: [ ... ] `告诉ESLint，你的配置扩展了给定的配置
  - `eslint:recommended`是ESLint内置的 "推荐 "配置--它打开了一个小的、合理的规则集，为众所周知的最佳实践提供了提示。
  - `plugin:@typescript-eslint/recommended`是我们的 "推荐 "配置--它就像`eslint:recommended`一样，只是它只开启我们TypeScript专用插件的规则。

由于vue有特殊的template语法，所以对于代码检测的部分，需要更换为[elint-pluign-vue](https://eslint.vuejs.org/user-guide/#what-is-the-use-the-latest-vue-eslint-parser-error)插件，根据里面的教程，我们对当前的代码检测进行替换修改，然后再添加部分需要的规则。
```javascript title=".eslintrc.js"
// @ts-check
const { defineConfig } = require("eslint-define-config");
module.exports = defineConfig({
  root: true,
  env: {
    browser: true,
    node: true,
    es6: true,
  },
  parser: "vue-eslint-parser",
  parserOptions: {
    parser: "@typescript-eslint/parser",
    ecmaVersion: 2020,
    sourceType: "module",
    jsxPragma: "React",
    ecmaFeatures: {
      jsx: true,
    },
  },
  extends: [
    "plugin:vue/vue3-recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier",
    "plugin:prettier/recommended",
  ],
  rules: {
    "vue/script-setup-uses-vars": "error",
    "@typescript-eslint/no-explicit-any": "off",
    "@typescript-eslint/no-var-requires": "off",
    "@typescript-eslint/no-empty-function": "off",

    "vue/require-default-prop": "off",
    "vue/html-self-closing": [
      "error",
      {
        html: {
          void: "always",
          normal: "never",
          component: "always",
        },
        svg: "always",
        math: "always",
      },
    ],
  },
});

```

此时需要安装的插件有
<Tabs
  groupId="vite_boilerplate"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'yarn', value: 'yarn'},
    {label: 'pnpm', value: 'pnpm'},
  ]}>
  <TabItem value="npm">

  ```shell
  npm i -D eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue prettier
  ```

  </TabItem>
  <TabItem value="yarn">

  ```shell
  yarn add -D eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue prettier
  ```

  </TabItem>
  <TabItem value="pnpm">

  ```shell
  pnpm i -D eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue prettier
  ```

  </TabItem>
</Tabs>

目前在`eslint`的配置部分暂告一段落，我们现在来添加运行时代码检测，这样就能实现统一的提交规范，不需要对每个电脑的不同代码格式化配置进行处理。

## vite-plugin-eslint
官方文档[vite-plugin-eslint](https://github.com/gxmari007/vite-plugin-eslint)

我们可以通过添加 `vite-plugin-eslint` 实现对 **非根目录下** 的文件进行自动格式化
<Tabs
  groupId="vite_boilerplate"
  defaultValue="npm"
  values={[
    {label: 'npm', value: 'npm'},
    {label: 'yarn', value: 'yarn'},
    {label: 'pnpm', value: 'pnpm'},
  ]}>
  <TabItem value="npm">

  ```shell
  npm i -D vite-plugin-eslint
  ```

  </TabItem>
  <TabItem value="yarn">

  ```shell
  yarn add -D vite-plugin-eslint
  ```

  </TabItem>
  <TabItem value="pnpm">

  ```shell
  pnpm i -D vite-plugin-eslint
  ```

  </TabItem>
</Tabs>

```javascript title="vite.config.ts"
import { defineConfig } from 'vite';
import eslintPlugin from 'vite-plugin-eslint';

export default defineConfig({
  plugins: [eslintPlugin({
      fix: true,
    })],
});
```
